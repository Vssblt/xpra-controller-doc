
<!-- vim-markdown-toc GitLab -->

* [NAP 应用层协议](#nap-应用层协议)
	* [一、介绍](#一介绍)
		* [1.1 什么是socket](#11-什么是socket)
		* [1.2 什么是 NAP 应用层协议](#12-什么是-nap-应用层协议)
		* [1.3 为什么需要 NAP 协议](#13-为什么需要-nap-协议)
		* [1.4 为什么不使用 HTTP](#14-为什么不使用-http)
	* [二、格式](#二格式)
		* [2.1 包格式](#21-包格式)
		* [2.2 包头格式](#22-包头格式)
	* [三、注意事项](#三注意事项)

<!-- vim-markdown-toc -->

# NAP 应用层协议


## 一、介绍

### 1.1 什么是socket

socket 的定义具有模糊性，具体定义可查看[维基百科 (Network socket)](https://en.wikipedia.org/wiki/Socket)，但在本文中定义如下：  
socket 是对 [OSI (Open System Interconnection)](https://en.wikipedia.org/wiki/OSI_model) 七层模型中部分协议的实现，其中包含 TCP/IP、ICMP 等协议。


### 1.2 什么是 NAP 应用层协议

NAP 应用层协议，是一套基于 TCP 传输层协议的应用层协议。


### 1.3 为什么需要 NAP 协议

因为 TCP 仅保证数据的正确性、合法性、顺序性和可靠性，且提供的数据为流式数据。因此对于开发者而言，需要一套能处理粘包问题、具有会话功能、具有请求与响应功能的应用层协议，且该协议提供多种抽象传输形式的数据格式（流和包）。


### 1.4 为什么不使用 HTTP

因为 HTTP 适合处理单向（客户端到服务端）短连接，而不适合处理双向长链接，在当前的应用场景下，服务端和客户端需要频繁进行双向通信，且均为长链接，因此HTTP不再适用。


## 二、格式

协议划分为包和流两种模式，本章主要描述包的结构。


### 2.1 包格式

协议分包头和包体，如下表格：

| 包头  | 包体         |
|-------|--------------|
| 8字节 | 小于2^32字节 |


### 2.2 包头格式

包头格式如下：

| 字节： | byte 0 | byte 1 | byte 2  byte 3 | byte4  byte 5  byte 6  byte 7 |
|--------|--------|--------|----------------|-------------------------------|
| 描述： | 版本号 | 标志位 | 端口           | 包体长度                      |
| 内容： | 置1    | 置0    | 置0            | sizeof(packet_body)           |


## 三、注意事项

**所有数据均采用大端模式，对接时务必注意自己采用的是什么字节序！**

[点击此处了解大小端以及字节序](https://en.wikipedia.org/wiki/Endianness)
